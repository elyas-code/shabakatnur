<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shabakat Nur Radio</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            background: #003;
            color: #fff;
            font-family: "Verdana", sans-serif;
            background-image: url('https://www.transparenttextures.com/patterns/stardust.png');
        }

        header {
            background: linear-gradient(to bottom, #990000, #660000);
            border-bottom: 3px solid #ffcc00;
            text-shadow: 1px 1px 2px #000;
        }

        h1 {
            font-family: "Tahoma", sans-serif;
            font-size: 32px;
            letter-spacing: 1px;
        }

        h2 {
            color: #ffcc00;
            text-shadow: 1px 1px 2px #000;
            font-family: "Trebuchet MS", sans-serif;
        }

        footer {
            background: linear-gradient(to top, #660000, #990000);
            border-top: 3px solid #ffcc00;
            font-family: "Courier New", monospace;
        }

        .nav-bar {
            background: #222;
            border-top: 2px solid #ffcc00;
            border-bottom: 2px solid #ffcc00;
            padding: 8px 0;
        }

        .nav-bar a {
            color: #ffcc00;
            text-decoration: none;
            margin: 0 15px;
            font-weight: bold;
        }

        .nav-bar a:hover {
            color: #fff;
            text-decoration: underline;
        }

        .btn {
            background: linear-gradient(to bottom, #ffcc00, #cc9900);
            border: 2px outset #996600;
            color: #000;
            padding: 5px 12px;
            font-family: Tahoma, sans-serif;
            font-size: 12px;
            cursor: pointer;
            margin: 3px;
        }

        .btn:hover {
            background: linear-gradient(to bottom, #ffff66, #ffcc00);
        }

        /* ===== Single-Pass CSS Marquee ===== */
        .marquee {
            background: #222;
            color: #ffcc00;
            padding: 5px 0;
            border-top: 2px solid #ffcc00;
            border-bottom: 2px solid #ffcc00;
            font-family: "Verdana", sans-serif;
            font-size: 13px;
            overflow: hidden;
            white-space: nowrap;
        }

        .marquee-content {
            display: inline-block;
            padding-left: 100%;
            /* Start off-screen */
            animation: marquee-scroll 70s linear infinite;
        }

        .marquee-content.rtl {
            padding-left: 0;
            padding-right: 100%;
            animation-name: marquee-scroll-rtl;
        }

        @keyframes marquee-scroll {
            from {
                transform: translateX(0%);
            }

            to {
                transform: translateX(-200%);
            }

            /* Scroll across and off the other side */
        }

        @keyframes marquee-scroll-rtl {
            from {
                transform: translateX(0%);
            }

            to {
                transform: translateX(200%);
            }
        }


        #playerStatus {
            font-size: 13px;
            color: #ffcc00;
            margin-top: 6px;
            font-style: italic;
        }

        /* ===== CD + Album Art Styling ===== */
        :root {
            --cd-image: url('https://fluorescent-lights.neocities.org/Digital-CD-Disk-Vector-Transparent-PNG.png');
        }

        .profile-pic {
            position: relative;
            width: 183px;
            filter: drop-shadow(0 0 0.25rem gray);
            margin: 0 auto;
        }

        .profile-pic:after {
            content: "";
            background: url('https://fluorescent-lights.neocities.org/f0rzNHe.png'),
                linear-gradient(150deg, rgba(255, 255, 255, 0.4),
                    rgba(255, 255, 255, 0.2), 40%, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.6));
            background-size: contain, cover;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .profile-pic:before {
            content: "";
            background: var(--cd-image);
            position: absolute;
            top: 5px;
            left: -20px;
            width: 150px;
            height: 150px;
            background-repeat: no-repeat;
            z-index: -1;
            animation-name: spin;
            animation-duration: 5000ms;
            animation-iteration-count: infinite;
            animation-timing-function: linear;
            transition: left ease 0.5s;
        }

        .profile-pic:hover:before {
            left: -75px;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .profile-pic img {
            width: 163px;
            height: 160px;
            object-fit: cover;
            border: none;
        }

        .nowplaying {
            margin-top: 20px;
            text-align: center;
        }

        .track-title {
            font-size: 16px;
            font-weight: bold;
            color: #ffcc00;
            text-shadow: 1px 1px 2px #000;
        }

        .track-artist {
            font-size: 14px;
            color: #ccc;
            font-style: italic;
        }

        #languageSelector {
            background-color: #333;
            color: #ffcc00;
            border: 1px solid #ffcc00;
            padding: 5px;
            border-radius: 5px;
            cursor: pointer;
        }

        .retro-card {
            background: #4a4a4a;
            /* A classic grey background */
            border: 3px outset #ccc;
            padding: 12px;
            margin-bottom: 10px;
            max-width: 450px;
            width: 100%;
            text-align: left;
            box-shadow: 5px 5px 0px #000;
            /* Hard, offset shadow for a 3D effect */
            font-family: "Arial", sans-serif;
            /* Using a more standard, retro font */
            position: relative;
            /* Needed for absolute positioning of 'Now Playing' */
        }

        .retro-card h3 {
            font-family: "Tahoma", sans-serif;
            font-size: 18px;
            font-weight: bold;
            color: #ffcc00;
            /* Using the theme's highlight color */
            text-shadow: 1px 1px 1px #000;
            margin: 0 0 8px 0;
        }

        .retro-card .description {
            font-size: 14px;
            color: #fff;
            margin-bottom: 10px;
        }

        .retro-card .time {
            font-family: "Courier New", monospace;
            font-size: 13px;
            color: #ccc;
            text-align: right;
        }

        /* Style for the blinking "Now Playing" */
        .now-playing-indicator {
            position: absolute;
            top: 10px;
            left: auto;
            right: 10px;
            background: linear-gradient(to bottom, #ff3333, #cc0000);
            color: white;
            padding: 2px 8px;
            font-size: 12px;
            font-weight: bold;
            border-radius: 3px;
            animation: retro-blink 1.5s infinite step-end;
            z-index: 10;
        }

        @keyframes retro-blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }
    </style>
</head>

<body>

    <!-- Header -->
    <header class="p-4 text-center">
        <h1 data-translate="shabakat_nur">Shabakat Nur</h1>
        <p data-translate="slogan">Latmiyas • Mawalid • Quran</p>
    </header>

    <!-- CSS Scrolling Marquee -->
    <div class="marquee">
        <span id="marquee-content" class="marquee-content" data-translate="welcome_marquee"></span>
    </div>

    <!-- Navigation bar -->
    <div class="nav-bar text-center">
        <a href="#" data-translate="home">Home</a>
        <a href="#" data-translate="schedule">Schedule</a>
        <a href="#" data-translate="live_stream_nav">Live Stream</a>
        <a href="#" data-translate="contact">Contact</a>
    </div>

    <!-- Player -->
    <section class="p-6 text-center">
        <h2 data-translate="live_stream_header">Live Stream</h2>

        <audio id="radioPlayer" src="https://albahrani.org/listen/shabakat_nur/SDradio.mp3" preload="auto"></audio>

        <div class="mt-4">
            <button id="playBtn" class="btn" title="Play" data-translate="play">Play</button>
            <button id="stopBtn" class="btn" title="Stop" data-translate="stop">Stop</button>
            <button id="volUpBtn" class="btn" data-translate="volume_up">Volume +</button>
            <button id="volDownBtn" class="btn" data-translate="volume_down">Volume −</button>
        </div>

        <div id="playerStatus" data-status-key="stopped"></div>

        <!-- Now Playing Section -->
        <div class="nowplaying mt-8">
            <div class="profile-pic">
                <img id="trackImage" src="https://albahrani.org/static/images/generic_album.jpg" alt="Album Art">
            </div>
            <div class="mt-4">
                <div id="trackTitle" class="track-title" data-translate="loading">Loading...</div>
                <div id="trackArtist" class="track-artist"></div>
            </div>
        </div>
    </section>

    <!-- Schedule -->
    <section id="schedule" class="p-6 text-center">
        <h2 class="text-xl font-semibold mb-4" data-translate="schedule_header">Schedule</h2>
        <div id="schedule-list" class="space-y-4 flex flex-col items-center"></div>
    </section>

    <script>
        async function loadSchedule() {
            try {
                const res = await fetch('https://albahrani.org/api/station/shabakat_nur/schedule');
                const data = await res.json();
                const container = document.getElementById('schedule-list');
                container.innerHTML = '';

                if (!data.length) {
                    container.innerHTML = `<p class="text-gray-400" data-translate="no_schedule">No schedule data available.</p>`;
                } else {
                    const now = new Date();
                    const lang = localStorage.getItem('language') || 'en';
                    data.forEach(show => {
                        const start = new Date(show.start);
                        const end = new Date(show.end);
                        const isCurrent = now >= start && now <= end;
                        const startStr = start.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                        const endStr = end.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                        const card = document.createElement('div');
                        card.className = `retro-card`;

                        let nowPlayingIndicator = '';
                        if (isCurrent) {
                            nowPlayingIndicator = `<div class="now-playing-indicator" data-translate="now_playing">${translations[lang].now_playing}</div>`;
                        }

                        card.innerHTML = `
                        ${nowPlayingIndicator}
                        <h3>${show.name}</h3>
                        <p class="description">${show.description || 'No description available.'}</p>
                        <p class="time">${startStr} - ${endStr}</p>`;
                        container.appendChild(card);
                    });
                }
            } catch (err) {
                console.error('Schedule error:', err);
                document.getElementById('schedule-list').innerHTML = `<p class="text-red-400" data-translate="failed_schedule">Failed to load schedule.</p>`;
            }
            const currentLang = localStorage.getItem('language') || 'en';
            translatePage(currentLang);
        }

    </script>

    <!-- Footer -->
    <footer class="p-3 text-center mt-6">
        <p>© 2005–2025 Shabakat Nur Radio | Powered by Azuracast</p>
        <p><a href="#" class="text-yellow-300 underline" data-translate="back_to_top">Back to top</a></p>
        <div class="mt-4">
            <select id="languageSelector">
                <option value="en">English</option>
                <option value="ar">العربية</option>
            </select>
        </div>
    </footer>

    <script>
        const player = document.getElementById("radioPlayer");
        const playBtn = document.getElementById("playBtn");
        const stopBtn = document.getElementById("stopBtn");
        const volUpBtn = document.getElementById("volUpBtn");
        const volDownBtn = document.getElementById("volDownBtn");
        const statusText = document.getElementById("playerStatus");
        const trackTitle = document.getElementById("trackTitle");
        const trackArtist = document.getElementById("trackArtist");
        const trackImage = document.getElementById("trackImage");
        const languageSelector = document.getElementById("languageSelector");
        const marqueeContent = document.getElementById("marquee-content");

        let prayerAndDateData = null; // To store fetched prayer times

        const translations = {
            en: {
                shabakat_nur: "Shabakat Nur",
                slogan: "Latmiyas • Mawalid • Quran",
                welcome_marquee: "Welcome to Shabakat Nur Radio – Streaming the Light of Faith 24/7 |  اللَّهُمَّ عَجِّل لِوَلِيِّكَ الْفَرَج | اللَّهُمَّ كُنْ لِوَلِيِّكَ الحُجَّةِ بْنِ الحَسَنِ صَلَواتُكَ عَلَيْهِ وَعَلى آبائِه فِي هذِهِ السّاعَةِ وَفِي كُلِّ ساعةٍ وَلِيّاً وَحافِظاً وَقائِداً وَناصِراً وَدَلِيلاً وَعَيْناً حَتّى تُسْكِنَهُ أَرْضَكَ طَوْعاً وَتُمَتِّعَهُ فِيْها طَوِيلاً",
                home: "Home", schedule: "Schedule", live_stream_nav: "Live Stream", contact: "Contact",
                live_stream_header: "Live Stream",
                play: "Play", stop: "Stop", volume_up: "Volume +", volume_down: "Volume −",
                loading: "Loading...", offline: "Offline", error_loading: "Error loading data",
                schedule_header: "Schedule", no_schedule: "No schedule data available.",
                failed_schedule: "Failed to load schedule.",
                back_to_top: "Back to top",
                status_stopped: "Status: Stopped",
                status_playing: "Status: Playing",
                status_volume: "Status: Volume: {value}%",
                weekdays: { "Sunday": "Sunday", "Monday": "Monday", "Tuesday": "Tuesday", "Wednesday": "Wednesday", "Thursday": "Thursday", "Friday": "Friday", "Saturday": "Saturday" },
                gregorian_months: { "January": "January", "February": "February", "March": "March", "April": "April", "May": "May", "June": "June", "July": "July", "August": "August", "September": "September", "October": "October", "November": "November", "December": "December" },
                imsak: "Imsak", fajr: "Fajr", dhuhr: "Dhuhr", maghrib: "Maghrib",
                now_playing: "Now Playing"
            },
            ar: {
                shabakat_nur: "شبكة نور",
                slogan: "لطميات • مواليد • قرآن",
                welcome_marquee: "أهلاً بكم في راديو شبكة نور - بث نور الإيمان ٧/٢٤ |  اللَّهُمَّ عَجِّل لِوَلِيِّكَ الْفَرَج | اللَّهُمَّ كُنْ لِوَلِيِّكَ الحُجَّةِ بْنِ الحَسَنِ صَلَواتُكَ عَلَيْهِ وَعَلى آبائِه فِي هذِهِ السّاعَةِ وَفِي كُلِّ ساعةٍ وَلِيّاً وَحافِظاً وَقائِداً وَناصِراً وَدَلِيلاً وَعَيْناً حَتّى تُسْكِنَهُ أَرْضَكَ طَوْعاً وَتُمَتِّعَهُ فِيْها طَوِيلاً | اللَّهُمَّ صَلِّ عَلَى مُحَمَّدٍ وَعَلَى آلِ مُحَمَّدٍ، كَمَا صَلَّيْتَ عَلَى إِبْرَاهِيمَ وَعَلَى آلِ إِبْرَاهِيمَ، إِنَّكَ حَمِيدٌ مَجِيدٌ، اللَّهُمَّ بَارِكْ عَلَى مُحَمَّدٍ وَعَلَى آلِ مُحَمَّدٍ، كَمَا بَارَكْتَ عَلَى إِبْرَاهِيمَ وَعَلَى آلِ إِبْرَاهِيمَ، إِنَّكَ حَمِيدٌ مَجِيدٌ",
                home: "الرئيسية", schedule: "الجدول الزمني", live_stream_nav: "البث المباشر", contact: "اتصل بنا",
                live_stream_header: "البث المباشر",
                play: "تشغيل", stop: "إيقاف", volume_up: "رفع الصوت", volume_down: "خفض الصوت",
                loading: "جار التحميل...", offline: "غير متصل", error_loading: "خطأ في تحميل البيانات",
                schedule_header: "الجدول الزمني", no_schedule: "لا توجد بيانات للجدول الزمني.",
                failed_schedule: "فشل تحميل الجدول الزمني.",
                back_to_top: "العودة إلى الأعلى",
                status_stopped: "الحالة: متوقف",
                status_playing: "الحالة: قيد التشغيل",
                status_volume: "الحالة: مستوى الصوت: {value}%",
                weekdays: { "Sunday": "الأحد", "Monday": "الاثنين", "Tuesday": "الثلاثاء", "Wednesday": "الأربعاء", "Thursday": "الخميس", "Friday": "الجمعة", "Saturday": "السبت" },
                gregorian_months: { "January": "يناير", "February": "فبراير", "March": "مارس", "April": "أبريل", "May": "مايو", "June": "يونيو", "July": "يوليو", "August": "أغسطس", "September": "سبتمبر", "October": "أكتوبر", "November": "نوفمبر", "December": "ديسمبر" },
                imsak: "الإمساك", fajr: "الفجر", dhuhr: "الظهر", maghrib: "المغرب",
                now_playing: "يذاع الآن"
            }
        };

        async function fetchPrayerAndDateInfo() {
            try {
                const response = await fetch('https://api.aladhan.com/v1/timingsByCity?city=Manama&country=Bahrain&method=0');
                const data = await response.json();
                if (data.code === 200) {
                    prayerAndDateData = data.data;
                } else {
                    console.error("Failed to fetch prayer times from AlAdhan API:", data.status);
                }
            } catch (error) {
                console.error("Error connecting to AlAdhan API:", error);
            }
        }

        function updateStatus(key, extraValue = "") {
            statusText.setAttribute('data-status-key', key);
            const lang = localStorage.getItem('language') || 'en';
            const translationKey = `status_${key}`;
            let text = translations[lang][translationKey] || `Status: ${key}`;

            if (extraValue) {
                text = text.replace('{value}', extraValue);
            }
            statusText.textContent = text;
        }

        function translatePage(lang) {
            // Get the current text of trackTitle before translation
            const currentTrackTitleText = trackTitle.textContent;

            document.querySelectorAll('[data-translate]').forEach(element => {
                // Add checks to explicitly skip trackTitle and trackArtist
                if (element.id === 'trackTitle' || element.id === 'trackArtist') {
                    // Skip translation for these elements if they already contain non-loading content
                    // (meaning fetchNowPlaying has likely updated them)
                    if (element.getAttribute('data-translate') === 'loading' && element.id === 'trackTitle' && currentTrackTitleText !== translations['en']['loading'] && currentTrackTitleText !== translations['ar']['loading']) {
                        // If trackTitle still has 'loading' as its data-translate but its text content is
                        // NOT 'Loading...' or 'جار التحميل...', then it means fetchNowPlaying has
                        // successfully updated it. Do not overwrite it.
                        return; // Skip this element
                    }
                    if (element.id === 'trackArtist' && element.textContent !== '') {
                        // If trackArtist has content, assume it's from fetchNowPlaying. Don't overwrite.
                        return;
                    }
                }


                if (element.id !== 'marquee-content' && !element.classList.contains('now-playing-indicator')) {
                    const key = element.getAttribute('data-translate');
                    if (translations[lang][key]) {
                        element.textContent = translations[lang][key];
                    }
                }
            });

            // Handle the "Now Playing" indicator translation if it exists
            document.querySelectorAll('.now-playing-indicator').forEach(indicator => {
                indicator.textContent = translations[lang].now_playing;
            });

            let marqueeText = translations[lang].welcome_marquee;
            if (prayerAndDateData) {
                const gDay = prayerAndDateData.date.gregorian.day;
                const gMonthKey = prayerAndDateData.date.gregorian.month.en;
                const gMonth = translations[lang].gregorian_months[gMonthKey];
                const gYear = prayerAndDateData.date.gregorian.year;
                const gWeekdayKey = prayerAndDateData.date.gregorian.weekday.en;
                const gWeekday = translations[lang].weekdays[gWeekdayKey];
                const gregorianString = `${gWeekday}, ${gDay} ${gMonth}, ${gYear}`;

                const hDay = prayerAndDateData.date.hijri.day;
                const hYear = prayerAndDateData.date.hijri.year;
                const hMonth = lang === 'ar' ? prayerAndDateData.date.hijri.month.ar : prayerAndDateData.date.hijri.month.en;
                const hWeekday = lang === 'ar' ? prayerAndDateData.date.hijri.weekday.ar : prayerAndDateData.date.hijri.weekday.en;
                const hijriString = `${hWeekday}, ${hDay} ${hMonth} ${hYear}`;

                const { Imsak, Fajr, Dhuhr, Maghrib } = prayerAndDateData.timings;

                const prayerString = ` | ${translations[lang].imsak}: ${Imsak} | ${translations[lang].fajr}: ${Fajr} | ${translations[lang].dhuhr}: ${Dhuhr} | ${translations[lang].maghrib}: ${Maghrib}`;

                marqueeText += ` | ${gregorianString} | ${hijriString}${prayerString}`;
            }
            marqueeContent.textContent = marqueeText;
        }

        function setLanguage(lang) {
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

            localStorage.setItem('language', lang);
            languageSelector.value = lang;

            if (lang === 'ar') {
                marqueeContent.classList.add('rtl');
            } else {
                marqueeContent.classList.remove('rtl');
            }

            translatePage(lang);

            const currentStatusKey = statusText.getAttribute('data-status-key');
            let extraInfo = "";
            if (currentStatusKey === 'volume') {
                extraInfo = (player.volume * 100).toFixed(0);
            }
            updateStatus(currentStatusKey, extraInfo);

            fetchNowPlaying();
            loadSchedule();
        }

        playBtn.addEventListener("click", () => { player.play(); updateStatus("playing"); });
        stopBtn.addEventListener("click", () => { player.pause(); player.currentTime = 0; updateStatus("stopped"); });
        volUpBtn.addEventListener("click", () => { player.volume = Math.min(1, player.volume + 0.1); updateStatus("volume", (player.volume * 100).toFixed(0)); });
        volDownBtn.addEventListener("click", () => { player.volume = Math.max(0, player.volume - 0.1); updateStatus("volume", (player.volume * 100).toFixed(0)); });

        languageSelector.addEventListener('change', (event) => { setLanguage(event.target.value); });

        async function fetchNowPlaying() {
            const lang = localStorage.getItem('language') || 'en';
            try {
                const response = await fetch("https://albahrani.org/api/nowplaying");
                const data = await response.json();
                const station = data.find(s => s.station.shortcode === "shabakat_nur");

                if (station && station.now_playing.song.title) {
                    trackTitle.textContent = station.now_playing.song.title;
                    trackArtist.textContent = station.now_playing.song.artist || "";
                    trackImage.src = station.now_playing.song.art || "https://albahrani.org/static/images/generic_album.jpg";
                } else {
                    trackTitle.textContent = translations[lang].offline;
                    trackArtist.textContent = "";
                    trackImage.src = "https://albahrani.org/static/images/generic_album.jpg";
                }
            } catch (e) {
                trackTitle.textContent = translations[lang].error_loading;
                trackArtist.textContent = "";
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await fetchPrayerAndDateInfo();
            const savedLang = localStorage.getItem('language') || 'en';
            setLanguage(savedLang);
            fetchNowPlaying();
            setInterval(loadSchedule, 30000);
            setInterval(fetchNowPlaying, 30000);
        });
    </script>

</body>

</html>