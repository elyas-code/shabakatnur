<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shabakat Nur Radio</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            background: #003;
            color: #fff;
            font-family: "Verdana", sans-serif;
            background-image: url('https://www.transparenttextures.com/patterns/stardust.png');
            min-height: 100vh;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        a {
            color: #ffcc00;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
            color: #fff;
        }

        .page-wrapper {
            max-width: 1200px;
            width: 100%;
            background: rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 20px #000;
            margin: 20px 0;
            border: 1px solid #444;
        }

        /* UPDATED HEADER STYLES */
        .site-header {
            background: #660000;
            /* Fallback color */
            border-bottom: 4px solid #ffcc00;
            padding: 0;
            /* Removed padding to allow image to be flush */
            text-align: center;
            overflow: hidden;
            line-height: 0;
            /* Removes small gap under image */
        }

        .site-banner {
            width: 100%;
            height: auto;
            display: block;
        }

        .marquee-container {
            background: #222;
            border-bottom: 2px solid #ffcc00;
            color: #fff;
            font-size: 13px;
            overflow: hidden;
            white-space: nowrap;
            height: 30px;
            line-height: 30px;
            position: relative;
        }

        .marquee-content {
            display: inline-block;
            padding-left: 100%;
            animation: marquee-scroll 60s linear infinite;
        }

        .marquee-content.rtl {
            padding-left: 0;
            padding-right: 100%;
            animation-name: marquee-scroll-rtl;
        }

        .content-dialog {
            width: min(900px, 95vw);
            max-height: 90vh;
            border: none;
            border-radius: 12px;
            padding: 0;
            background: #0e0e0e;
            color: #eee;
        }

        .content-dialog::backdrop {
            background: rgba(0, 0, 0, 0.6);
        }

        .dialog-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.25rem;
            border-bottom: 1px solid #222;
        }

        .dialog-header button {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: #aaa;
            cursor: pointer;
        }

        #dialog-body {
            padding: 1.25rem;
            overflow-y: auto;
        }

        @keyframes marquee-scroll {
            from {
                transform: translateX(0%);
            }

            to {
                transform: translateX(-200%);
            }
        }

        @keyframes marquee-scroll-rtl {
            from {
                transform: translateX(0%);
            }

            to {
                transform: translateX(200%);
            }
        }

        .content-container {
            display: flex;
            flex-direction: row;
            width: 100%;
            gap: 15px;
            padding: 15px;
            align-items: flex-start;
            box-sizing: border-box;
        }

        .sidebar {
            width: 240px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .center-column {
            flex-grow: 1;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid #444;
            padding: 10px;
            min-height: 600px;
        }

        .side-block {
            border: 1px solid #ffcc00;
            background: #111;
            box-shadow: 2px 2px 5px #000;
        }

        .block-title {
            background: linear-gradient(to bottom, #990000, #660000);
            color: #fff;
            font-weight: bold;
            padding: 6px 10px;
            border-bottom: 2px solid #ffcc00;
            font-family: "Tahoma", sans-serif;
            font-size: 14px;
            text-align: center;
        }

        .block-content {
            padding: 10px;
            font-size: 13px;
            color: #ddd;
        }

        .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-list li {
            border-bottom: 1px solid #333;
            padding: 6px 0;
            text-align: center;
        }

        .nav-list li:last-child {
            border-bottom: none;
        }

        .nav-link {
            display: block;
            width: 100%;
            font-weight: bold;
            transition: color 0.2s;
        }

        .nav-link.active {
            color: #fff;
            background: #333;
            border-radius: 4px;
        }

        .input-field {
            width: 100%;
            padding: 5px;
            background: #333;
            color: #fff;
            border: 1px solid #555;
            margin-bottom: 5px;
            font-size: 12px;
        }

        .prayer-table {
            width: 100%;
            text-align: center;
            font-size: 12px;
        }

        .prayer-table td {
            padding: 4px;
            border-bottom: 1px solid #333;
        }

        .prayer-table tr:last-child td {
            border-bottom: none;
        }

        .btn {
            background: linear-gradient(to bottom, #ffcc00, #cc9900);
            border: 2px outset #996600;
            color: #000;
            padding: 4px 10px;
            font-family: Tahoma, sans-serif;
            font-size: 11px;
            cursor: pointer;
            margin: 2px;
        }

        .btn:hover {
            background: linear-gradient(to bottom, #ffff66, #ffcc00);
        }

        :root {
            --cd-image: url('Digital-CD-Disk-Vector-Transparent-PNG.png');
        }

        .profile-pic {
            position: relative;
            width: 183px;
            filter: drop-shadow(0 0 0.25rem gray);
            margin: 20px auto;
            direction: rtl;
        }

        .profile-pic:after {
            content: "";
            background: url('f0rzNHe.png'),
                linear-gradient(150deg, rgba(255, 255, 255, 0.4),
                    rgba(255, 255, 255, 0.2), 40%, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.6));
            background-size: contain, cover;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .profile-pic:before {
            content: "";
            background: var(--cd-image);
            position: absolute;
            top: 5px;
            left: -20px;
            width: 150px;
            height: 150px;
            background-repeat: no-repeat;
            z-index: -1;
            animation-name: spin;
            animation-duration: 5000ms;
            animation-iteration-count: infinite;
            animation-timing-function: linear;
            transition: left ease 0.5s;
        }

        .profile-pic:hover:before {
            left: -75px;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .profile-pic img {
            width: 163px;
            height: 160px;
            object-fit: cover;
            border: none;
        }

        .track-title {
            color: #ffcc00;
            font-weight: bold;
            font-size: 15px;
            margin-top: 5px;
        }

        .track-artist {
            font-style: italic;
            color: #ccc;
            font-size: 13px;
        }

        .retro-card {
            background: #2a2a2a;
            border: 2px outset #555;
            padding: 10px;
            margin-bottom: 10px;
            width: 100%;
        }

        html[dir='rtl'] .retro-card {
            text-align: right;
        }

        .retro-card h3 {
            color: #ffcc00;
            font-weight: bold;
            border-bottom: 1px solid #444;
            margin-bottom: 5px;
        }

        .page-view {
            display: none;
            animation: fadeIn 0.5s;
        }

        .page-view.active-view {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @media (max-width: 900px) {
            .content-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                order: 2;
            }

            .center-column {
                width: 100%;
                order: 1;
                margin-bottom: 20px;
            }
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .category-card {
            background: linear-gradient(to bottom, #2a2a2a, #1a1a1a);
            border: 2px outset #555;
            padding: 8px 10px;
            cursor: pointer;
            text-align: center;
            font-weight: bold;
            font-size: 13px;
            color: #ffcc00;
            transition: all 0.15s ease;
        }

        .category-card:hover {
            background: linear-gradient(to bottom, #333, #222);
        }

        .category-card.active {
            background: linear-gradient(to bottom, #990000, #660000);
            color: #fff;
            border-color: #ffcc00;
        }

        html[dir='rtl'] .category-card {
            text-align: center;
        }

        footer {
            background: linear-gradient(to top, #660000, #990000);
            border-top: 3px solid #ffcc00;
            padding: 10px;
            text-align: center;
            font-size: 12px;
            margin-top: auto;
            width: 100%;
        }

        @media (max-width: 768px) {
            iframe {
                height: 60vh;
            }
        }
    </style>
</head>

<body>

    <div class="page-wrapper">
        <header class="site-header">
            <img src="banner.jpeg" alt="Shabakat Nur Radio Banner" class="site-banner">
        </header>

        <div class="marquee-container">
            <span id="marquee-content" class="marquee-content" data-translate="welcome_marquee"></span>
        </div>

        <div class="content-container">
            <aside class="sidebar" id="right-sidebar">
                <div class="side-block">
                    <div class="block-title" data-translate="menu_header">Main Menu</div>
                    <div class="block-content">
                        <ul class="nav-list">
                            <li><a href="?page=home" class="nav-link" data-page="home" data-translate="home">Home
                                    Page</a></li>
                            <li><a href="?page=schedule" class="nav-link" data-page="schedule"
                                    data-translate="schedule">Schedule</a></li>
                            <li><a href="?page=lyrics" class="nav-link" data-page="lyrics"
                                    data-translate="lyrics">Lyrics</a></li>
                            <li><a href="?page=resources" class="nav-link" data-page="resources"
                                    data-translate="resources">Resources</a></li>
                            <li><a href="?page=contact" class="nav-link" data-page="contact"
                                    data-translate="contact">Contact Us</a></li>
                        </ul>
                    </div>
                </div>

                <div class="side-block">
                    <div class="block-title" data-translate="newsletter_header">Newsletter</div>
                    <form id="newsletter-form">
                        <div class="block-content" style="text-align: center;">
                            <input type="email" class="input-field" name="fields[email]" placeholder="email@example.com"
                                required>
                            <button type="submit" class="btn" style="width: 100%;"
                                data-translate="subscribe">Subscribe</button>
                            <p class="newsletter-success" data-translate="newsletter_success" hidden>Thanks for
                                subscribing!</p>
                            <p class="newsletter-error" data-translate="newsletter_error" hidden>Something went wrong.
                                Try again.</p>
                        </div>
                    </form>
                </div>

                <div class="side-block">
                    <div class="block-title" data-translate="search_header">Search</div>
                    <div class="block-content">
                        <input id="searchInput" type="text" class="input-field" placeholder="...">
                        <button id="searchBtn" class="btn" style="width: 100%;"
                            data-translate="search_btn">Search</button>
                    </div>
                </div>

                <div class="side-block">
                    <div class="block-title" data-translate="lang">Language</div>
                    <div class="block-content" style="text-align: center;">
                        <select id="languageSelector" class="input-field">
                            <option value="en">English</option>
                            <option value="ar">العربية</option>
                            <option value="fa">فارسی</option>
                        </select>
                    </div>
                </div>
            </aside>

            <main class="center-column">
                <div id="view-home" class="page-view active-view">
                    <div class="retro-card" style="text-align: center; overflow: visible;">
                        <h3 data-translate="live_stream_header">Live Stream</h3>
                        <audio id="radioPlayer" src="https://albahrani.org/listen/shabakat_nur/SDradio.mp3"
                            preload="auto"></audio>
                        <div style="margin: 10px 0;">
                            <button id="playBtn" class="btn" data-translate="play">Play</button>
                            <button id="stopBtn" class="btn" data-translate="stop">Stop</button>
                            <button id="volUpBtn" class="btn">+</button>
                            <button id="volDownBtn" class="btn">−</button>
                        </div>
                        <div id="playerStatus" style="font-size: 11px; color: #aaa; margin-bottom: 15px;">Status:
                            Stopped</div>
                        <div class="profile-pic">
                            <img id="trackImage" src="https://albahrani.org/static/images/generic_album.jpg"
                                alt="Album Art">
                        </div>
                        <div id="trackTitle" class="track-title" data-translate="loading">Loading...</div>
                        <div id="trackArtist" class="track-artist"></div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <div class="retro-card">
                            <h3 data-translate="about_header">About Station</h3>
                            <p style="font-size: 12px; line-height: 1.4; color: #ddd;" data-translate="about_text">
                                Shabakat Nur is a 24/7 online radio station dedicated to streaming the finest Latmiyas,
                                Mawalid, and Quran recitations.
                            </p>
                        </div>
                        <div class="retro-card">
                            <h3 data-translate="features_header">Broadcasts</h3>
                            <ul style="font-size: 12px; padding-left: 20px; list-style-type: square; color: #ddd;">
                                <li data-translate="feature_1">Exclusive Latmiyas</li>
                                <li data-translate="feature_2">Live Mawalid</li>
                                <li data-translate="feature_3">Daily Quran</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="view-schedule" class="page-view">
                    <div class="retro-card">
                        <h3 data-translate="schedule_header">Broadcast Schedule</h3>
                        <div id="schedule-list" style="padding: 10px;">
                            <p data-translate="loading">Loading...</p>
                        </div>
                    </div>
                </div>
                <div id="view-search" class="page-view">
                    <div class="retro-card">
                        <h3 data-translate="search_header">Search</h3>
                        <div id="search-results" style="margin-top:10px;">
                            <p data-translate="loading">Loading...</p>
                        </div>
                    </div>
                </div>

                <div id="view-lyrics" class="page-view">
                    <div class="retro-card">
                        <h3 data-translate="lyrics_header"></h3>

                        <div id="lyrics-categories" class="category-grid"></div>
                        <div id="lyrics-list"></div>
                        <div id="lyrics-content"></div>
                    </div>
                </div>

                <div id="view-resources" class="page-view">
                    <div class="retro-card">
                        <h3 data-translate="resources_header">Learning Resources</h3>

                        <div id="resources-categories" class="category-grid"></div>
                        <div id="resources-list"></div>
                        <div id="resources-content"></div>
                    </div>
                </div>

                <div id="view-contact" class="page-view">
                    <div class="retro-card">
                        <h3 data-translate="contact_header">Contact Us</h3>
                        <div style="padding: 10px;">
                            <strong data-translate="email_header">Email:</strong><br>
                            <a href="mailto:elyas@albahrani.org">elyas@albahrani.org</a>
                            <br><br>
                            <strong data-translate="social_header">Social:</strong><br>
                            Twitter: @ShabakatNur<br>
                            Instagram: @ShabakatNur<br>
                            Bluesky: @albahrani.org
                        </div>
                    </div>
                </div>
            </main>

            <aside class="sidebar" id="left-sidebar">
                <div class="side-block">
                    <div class="block-title" data-translate="prayer_times_header">Prayer Times</div>
                    <div class="block-content">
                        <div id="prayer-display">
                            <p style="text-align:center; font-size:11px; color:#aaa;" data-translate="loading">
                                Loading...</p>
                        </div>
                    </div>
                </div>

                <div class="side-block">
                    <div class="block-title" data-translate="date_header">Date</div>
                    <div class="block-content" style="text-align: center;">
                        <div id="date-display-greg" style="font-weight: bold; color: #ffcc00; margin-bottom: 2px;">
                        </div>
                        <div id="date-display-hijri" style="font-size: 11px; color: #ccc;"></div>
                    </div>
                </div>

                <div class="side-block">
                    <div class="block-title" data-translate="users_header">Online</div>
                    <div class="block-content">
                        <div style="display:flex; align-items:center; gap:5px; font-size: 12px;">
                            <a href="https://info.flagcounter.com/6HUE"><img
                                    src="https://s01.flagcounter.com/count2/6HUE/bg_FFFFFF/txt_000000/border_CCCCCC/columns_3/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/percent_0/"
                                    alt="Flag Counter" border="0"></a>
                        </div>
                    </div>
                </div>
            </aside>
        </div>

        <footer>
            <p>© 2005–2025 Shabakat Nur Radio | Powered by Azuracast</p>
            <p><a href="#" id="scrollTopBtn" data-translate="back_to_top">Back to top</a></p>
        </footer>
    </div>
    <dialog id="content-dialog" class="content-dialog">
        <div class="dialog-header">
            <h3 id="dialog-title"></h3>
            <button id="dialog-close">✕</button>
        </div>
        <div id="dialog-body"></div>
    </dialog>
    <script>
        const libraries = {
            lyrics: {
                categories: {
                    iran: {
                        title: { en: "Iran", ar: "إيران", fa: "ایران" }
                    },
                    iraq: {
                        title: { en: "Iraq", ar: "العراق", fa: "عراق" }
                    },
                    bahrain: {
                        title: { en: "Bahrain", ar: "البحرين", fa: "بحرین" }
                    }
                },
                items: [
                    {
                        id: "salam_farmandeh",
                        category: "iran",
                        title: {
                            en: "Salam Farmandeh",
                            ar: "سلام فرمانده",
                            fa: "سلام فرمانده"
                        },
                        type: "text",
                        content: `
عشق جانم امام زمانم، دنيا بدون تو معنايي نداره
عشق روزگارم وقتي كه تو باشي دنيامون بهاره
سلام فرمانده، سلام از اين نسل غيور جامانده
سلام فرمانده، سيد علي دهه‌ نودي‌‌هاشو فراخوانده

سلام فرمانده، بيا جون من بيا، بيا يارت ميشم
هوادارت ميشم، گرفتارت ميشم، علي بن مهزيارت ميشم
با همين قد كوچيكم خودم، سردارت ميشم
نبين قدم كوچيكه، پاش بيفته من برات قيام ميكنم
نبين قدم كوچيكه، مثل ميرزا كوچك كار و تمام ميكنم
نبين قدم كوچيكه، از صف سيصد و سيزده تا بهت سلام ميكنم

نبين كمه سنم، تو فقط صِدام بزن ببين چيكار برات ميكنم
نبين كمه سنم، با همين دستاي كوچيكم همش دُعات ميكنم
نبين كمه سنم، بأبي انت و أمي همه رو فدات ميكنم

عهد ميبندم، روزي لازمت بشم، عهد ميبندم حاج قاسمت بشم
عـهد ميبندم، مثل بهجت و مثل سربازاي گمنام خادمت بشم
عهد ميبندم كه ميمونم، پاي كار اين نظام
كاشكي مثل حاج قاسم، من به چشم تو بيام

هزار و صد و اندي ساله، همه عالم دنبال مهدي اند
غصه سرباز و نخور آقا، سربازات هزار و چهارصدي اند`
                    }
                ]
            },

            resources: {
                categories: {
                    poetry: {
                        title: { en: "Poetry", ar: "الشعر", fa: "شعر" }
                    },
                    recitation: {
                        title: { en: "Recitation", ar: "الإلقاء", fa: "نوحه خوانی" }
                    },

                    fiqh: {
                        title: { en: "Fiqh", ar: "الفقه", fa: "فقه" }
                    }
                },
                items: [
                    {
                        id: "arabic_prosody",
                        category: "poetry",
                        title: {
                            en: "Arabic Prosody",
                            ar: "أساسيات العروض",
                            fa: "مبانی عروض عربی"
                        },
                        type: "text",
                        content: {
                            en: `
Poetry is built on meters.
Each meter has rhythm.
    `,
                            ar: `
الشعر يقوم على الأوزان.
    `                        }
                    },
                    {
                        id: "albayan-fi-alshi3r",
                        category: "poetry",
                        title: {
                            en: "Expression in Husayni Poetry",
                            ar: "البيان في الشعر الحسيني",
                            fa: "بیان در شعر حسینی"
                        },
                        type: "pdf",
                        file: "/pdf/poetry/bayan-fi-shi3r-hussaini.pdf"
                    },
                    {
                        id: "fiqh_research",
                        category: "fiqh",
                        title: {
                            en: "Research in Islamic jurisprudence, general discussions on contracts (contract theory in Islamic jurisprudence)",
                            ar: "مدخل إلى بحوث في الفقه، مباحث عامة حول العقد (نظرية العقد في الفقه الإسلامي)",
                            fa: "پژوهش در فقه اسلامی، مباحث کلی در باب قراردادها (نظریه قرارداد در فقه اسلامی)"
                        },
                        type: "pdf",
                        file: "/pdf/fiqh/research-in-islamic-jurispudence.pdf"
                    }
                ]
            }
        };

        const translations = {
            en: {
                welcome_marquee: "Welcome to Shabakat Nur Radio – Streaming the Light of Faith 24/7 |  اللَّهُمَّ عَجِّل لِوَلِيِّكَ الْفَرَج | اللَّهُمَّ كُنْ لِوَلِيِّكَ الحُجَّةِ بْنِ الحَسَنِ صَلَواتُكَ عَلَيْهِ وَعَلى آبائِه فِي هذِهِ السّاعَةِ وَفِي كُلِّ ساعةٍ وَلِيّاً وَحافِظاً وَقائِداً وَناصِراً وَدَلِيلاً وَعَيْناً حَتّى تُسْكِنَهُ أَرْضَكَ طَوْعاً وَتُمَتِّعَهُ فِيْها طَوِيلاً",
                menu_header: "Main Menu", search_header: "Search", newsletter_header: "Newsletter", subscribe: "Subscribe",
                search_btn: "Search", prayer_times_header: "Prayer Times", date_header: "Today's Date",
                users_header: "Online Users", home: "Home Page", schedule: "Schedule", contact: "Contact Us",
                lyrics: "Lyrics", resources: "Resources", lyrics_header: "Lyrics Library", resources_header: "Learning Resources",
                live_stream_header: "Live Stream", play: "Play", stop: "Stop", loading: "Loading...",
                about_header: "About Station", about_text: "Shabakat Nur is a 24/7 online radio station dedicated to streaming the finest Latmiyas, Mawalid, and Quran recitations.",
                features_header: "Broadcasts", feature_1: "Exclusive Latmiyas", feature_2: "Live Mawalid", feature_3: "Daily Quran",
                schedule_header: "Broadcast Schedule", contact_header: "Contact Us", email_header: "Email",
                social_header: "Social Media", back_to_top: "Back to top", imsak: "Imsak", fajr: "Fajr",
                dhuhr: "Dhuhr", maghrib: "Maghrib", sunrise: "Sunrise", now_playing: "Now Playing",
                lang: "Language", newsletter_success: "Thanks for subscribing!", newsletter_error: "Something went wrong. Try again.", no_results: "No results found."
            },
            ar: {
                welcome_marquee: "أهلاً بكم في راديو شبكة نور - بث نور الإيمان ٧/٢٤ |  اللَّهُمَّ عَجِّل لِوَلِيِّكَ الْفَرَج | اللَّهُمَّ كُنْ لِوَلِيِّكَ الحُجَّةِ بْنِ الحَسَنِ صَلَواتُكَ عَلَيْهِ وَعَلى آبائِه فِي هذِهِ السّاعَةِ وَفِي كُلِّ ساعةٍ وَلِيّاً وَحافِظاً وَقائِداً وَناصِراً وَدَلِيلاً وَعَيْناً حَتّى تُسْكِنَهُ أَرْضَكَ طَوْعاً وَتُمَتِّعَهُ فِيْها طَوِيلاً",
                menu_header: "القائمة الرئيسية", search_header: "البحث", newsletter_header: "القائمة البريدية", subscribe: "إشتراك",
                search_btn: "بحث", prayer_times_header: "أوقات الصلاة", date_header: "تاريخ اليوم",
                users_header: "المتواجدون حالياً", home: "الصفحة الرئيسية", schedule: "الجدول الزمني", contact: "إتصل بنا",
                lyrics: "القصائد", resources: "المصادر", lyrics_header: "مكتبة القصائد", resources_header: "المصادر التعليمية",
                live_stream_header: "البث المباشر", play: "تشغيل", stop: "إيقاف", loading: "جار التحميل...",
                about_header: "عن الإذاعة", about_text: "شبكة نور هي إذاعة إلكترونية تبث على مدار ٢٤ ساعة، مخصصة لنشر أجمل اللطميات والمواليد وتلاوات القرآن الكريم.",
                features_header: "ماذا نبث", feature_1: "لطميات حصرية", feature_2: "مواليد مباشرة", feature_3: "تلاوات يومية",
                schedule_header: "جدول البث", contact_header: "اتصل بنا", email_header: "البريد الإلكتروني",
                social_header: "وسائل التواصل", back_to_top: "العودة إلى الأعلى", imsak: "الإمساك", fajr: "الفجر",
                dhuhr: "الظهرين", maghrib: "العشائين", sunrise: "الشروق", now_playing: "يذاع الآن",
                lang: "اللغة", newsletter_success: "شكراً لاشتراكك!", newsletter_error: "حدث خطأ ما. حاول مرة أخرى.", no_results: "لم يتم العثور على نتائج."
            },
            fa: {
                welcome_marquee: "به رادیو شبکه نور خوش آمدید – پخش نور ایمان به صورت ۲۴/۷ | اللَّهُمَّ عَجِّل لِوَلِيِّكَ الْفَرَج | اللَّهُمَّ كُنْ لِوَلِيِّكَ الحُجَّةِ بْنِ الحَسَنِ صَلَواتُكَ عَلَيْهِ وَعَلى آبائِه فِي هذِهِ السّاعَةِ وَفِي كُلِّ ساعةٍ وَلِيّاً وَحافِظاً وَقائِداً وَناصِراً وَدَلِيلاً وَعَيْناً حَتّى تُسْكِنَهُ أَرْضَكَ طَوْعاً وَتُمَتِّعَهُ فِيْها طَوِيلاً",
                menu_header: "منوی اصلی", search_header: "جستجو", newsletter_header: "خبرنامه", subscribe: "اشتراک",
                search_btn: "جستجو", prayer_times_header: "اوقات شرعی", date_header: "تاریخ امروز",
                users_header: "کاربران آنلاین", home: "صفحه اصلی", schedule: "برنامه پخش", contact: "تماس با ما",
                lyrics: "متن نوحه", resources: "منابع آموزشی", lyrics_header: "کتابخانه متن", resources_header: "منابع آموزشی",
                live_stream_header: "پخش زنده", play: "پخش", stop: "توقف", loading: "در حال بارگذاری...",
                about_header: "درباره ایستگاه", about_text: "رادیو شبکه نور یک ایستگاه آنلاین ۲۴/۷ است که به پخش بهترین لتمیاها، مولودی‌ها و تلاوت‌های قرآن اختصاص دارد.",
                features_header: "پخش‌ها", feature_1: "لتمیاهای اختصاصی", feature_2: "مولودی زنده", feature_3: "قرآن روزانه",
                schedule_header: "برنامه پخش", contact_header: "تماس با ما", email_header: "ایمیل",
                social_header: "شبکه‌های اجتماعی", back_to_top: "بازگشت به بالا", imsak: "امساک", fajr: "فجر",
                dhuhr: "ظهر", maghrib: "مغرب", sunrise: "طلوع خورشید", now_playing: "در حال پخش",
                lang: "زبان", newsletter_success: "با تشکر از اشتراک شما!", newsletter_error: "مشکلی پیش آمد. دوباره تلاش کنید.", no_results: "نتیجه‌ای یافت نشد."
            }

        };

        const dialog = document.getElementById("content-dialog");
        const dialogTitle = document.getElementById("dialog-title");
        const dialogBody = document.getElementById("dialog-body");

        document.getElementById("dialog-close").onclick = () => dialog.close();

        function renderLibrary({ libraryKey, categoriesEl, listEl, contentEl }) {
            const lang = localStorage.getItem("language") || "en";
            const lib = libraries[libraryKey];

            // categories
            categoriesEl.innerHTML = Object.entries(lib.categories)
                .map(([key, cat]) => `
      <div class="category-card" data-cat="${key}">
        <h4>${cat.title[lang]}</h4>
      </div>
    `).join("");

            categoriesEl.onclick = e => {
                const card = e.target.closest(".category-card");
                if (!card) return;

                categoriesEl.querySelectorAll(".category-card")
                    .forEach(c => c.classList.remove("active"));
                card.classList.add("active");

                const cat = card.dataset.cat;
                const items = lib.items.filter(i => i.category === cat);

                listEl.innerHTML = items.map(i => `
    <div class="retro-card" data-id="${i.id}" style="cursor:pointer">
      ${i.title[lang]}
    </div>
  `).join("");
            };
            const first = categoriesEl.querySelector(".category-card");
            if (first) first.click();

            listEl.onclick = e => {
                const card = e.target.closest("[data-id]");
                if (!card) return;

                const lang = localStorage.getItem("language") || "en";
                const item = lib.items.find(i => i.id === card.dataset.id);

                dialogTitle.textContent = item.title[lang];

                if (item.type === "pdf") {
                    dialogBody.innerHTML = `
      <iframe src="${item.file}"
              style="width:100%;height:70vh;border:none;background:#111">
      </iframe>
    `;
                } else {
                    let text = "";

                    if (typeof item.content === "string") {
                        text = item.content;
                    } else {
                        text = item.content?.[lang] || "";
                    }
                    dialogBody.innerHTML = `
      <div style="white-space:pre-wrap;line-height:1.9;font-size:1.05rem">
        ${text}
      </div>
    `;
                }

                dialog.showModal();
            };
        }

        function loadLibraries() {
            renderLibrary({
                libraryKey: "lyrics",
                categoriesEl: document.getElementById("lyrics-categories"),
                listEl: document.getElementById("lyrics-list"),
                contentEl: document.getElementById("lyrics-content")
            });

            renderLibrary({
                libraryKey: "resources",
                categoriesEl: document.getElementById("resources-categories"),
                listEl: document.getElementById("resources-list"),
                contentEl: document.getElementById("resources-content")
            });

            if (document.getElementById("view-lyrics").classList.contains("active-view")) {
                renderLibrary({
                    libraryKey: "lyrics",
                    categoriesEl: lyricsCategories,
                    listEl: lyricsList,
                    contentEl: lyricsContent
                });
            }
        }
        loadLibraries();

        function getParameterByName(name) {
            const url = new URL(window.location.href);
            return url.searchParams.get(name) || 'home';
        }

        function renderPage(pageName) {
            const validPages = ['home', 'schedule', 'contact', 'lyrics', 'resources', 'search'];
            if (!validPages.includes(pageName)) pageName = 'home';

            document.querySelectorAll('.page-view').forEach(view => view.classList.remove('active-view'));
            const target = document.getElementById(`view-${pageName}`);
            if (target) target.classList.add('active-view');

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === pageName) link.classList.add('active');
            });
            if (pageName === 'schedule') loadSchedule();
            if (pageName === 'search') {
                const q = getParameterByName('q');
                renderSearchPage(q);
            }

        }
        document.getElementById("searchBtn").addEventListener("click", () => {
            const q = document.getElementById("searchInput").value.trim();
            if (!q) return;

            window.history.pushState(
                {},
                "",
                `?page=search&q=${encodeURIComponent(q)}`
            );

            renderPage("search");
        });

        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const page = link.getAttribute('data-page');
                window.history.pushState({ path: `?page=${page}` }, '', `?page=${page}`);
                renderPage(page);
            });
        });

        window.addEventListener('popstate', () => renderPage(getParameterByName('page')));


        const persianWeekdays = ['یکشنبه', 'دوشنبه', 'سه‌شنبه', 'چهارشنبه', 'پنج‌شنبه', 'جمعه', 'شنبه'];
        const persianMonths = ['فروردین', 'اردیبهشت', 'خرداد', 'تیر', 'مرداد', 'شهریور', 'مهر', 'آبان', 'آذر', 'دی', 'بهمن', 'اسفند'];

        function gregorianToJalali(gy, gm, gd) {
            var g_d_m = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];
            var jy = (gy <= 1600) ? 0 : 979;
            gy -= (gy <= 1600) ? 621 : 1600;
            var gy2 = (gm > 2) ? (gy + 1) : gy;
            var days = 365 * gy + Math.floor((gy2 + 3) / 4) - Math.floor((gy2 + 99) / 100) + Math.floor((gy2 + 399) / 400) - 80 + gd + g_d_m[gm - 1];
            jy += 33 * Math.floor(days / 12053);
            days %= 12053;
            jy += 4 * Math.floor(days / 1461);
            days %= 1461;
            if (days > 365) {
                jy += Math.floor((days - 1) / 365);
                days = (days - 1) % 365;
            }
            var jm = (days < 186) ? 1 + Math.floor(days / 31) : 7 + Math.floor((days - 186) / 30);
            var jd = 1 + ((days < 186) ? (days % 31) : ((days - 186) % 30));
            return [jy, jm, jd];
        }
        async function fetchPrayerInfo() {
            try {
                console.log("Fetching prayer info...");
                const res = await fetch('https://api.aladhan.com/v1/timingsByCity?city=Manama&country=Bahrain&method=0');
                const data = await res.json();
                console.log("Raw API data:", data);

                if (data.code !== 200) return;

                const t = data.data.timings;
                const d = data.data.date;
                const lang = localStorage.getItem('language') || 'en';
                console.log("Language:", lang);

                let gregDateStr = "";

                if (lang === 'fa') {
                    const [day, month, year] = d.gregorian.date.split('-').map(Number);
                    const [jy, jm, jd] = gregorianToJalali(year, month, day);
                    const weekdayIndex = new Date(year, month - 1, day).getDay();
                    gregDateStr = `${persianWeekdays[weekdayIndex]}، ${jd} ${persianMonths[jm - 1]} ${jy}`;
                } else if (lang === 'ar') {
                    const [day, month, year] = d.gregorian.date.split('-');
                    const dateObj = new Date(`${year}-${month}-${day}`);
                    gregDateStr = new Intl.DateTimeFormat('ar-BH', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' }).format(dateObj);
                } else {
                    gregDateStr = `${d.gregorian.weekday.en}, ${d.gregorian.day} ${d.gregorian.month.en} ${d.gregorian.year}`;
                }
                console.log("Gregorian display string:", gregDateStr);

                const hijriDateStr = (lang === 'ar' || lang === 'fa')
                    ? `${d.hijri.weekday.ar}، ${d.hijri.day} ${d.hijri.month.ar} ${d.hijri.year}`
                    : `${d.hijri.weekday.en}, ${d.hijri.day} ${d.hijri.month.en} ${d.hijri.year}`;
                console.log("Hijri display string:", hijriDateStr);

                document.getElementById('date-display-greg').textContent = gregDateStr;
                document.getElementById('date-display-hijri').textContent = hijriDateStr;

                const labels = translations[lang];
                const html = `
            <table class="prayer-table">
                <tr><td>${labels.fajr}</td><td>${t.Fajr}</td></tr>
                <tr><td>${labels.sunrise}</td><td>${t.Sunrise}</td></tr>
                <tr><td>${labels.dhuhr}</td><td>${t.Dhuhr}</td></tr>
                <tr><td>${labels.maghrib}</td><td>${t.Maghrib}</td></tr>
            </table>
            <div style="text-align:center; margin-top:5px; font-size:10px; color:#888;">Manama, Bahrain</div>
        `;
                document.getElementById('prayer-display').innerHTML = html;

            } catch (e) {
                console.error("Error fetching prayer info:", e);
            }
        }

        const player = document.getElementById("radioPlayer");
        document.getElementById("playBtn").addEventListener("click", () => { player.play(); document.getElementById("playerStatus").textContent = "Status: Playing"; });
        document.getElementById("stopBtn").addEventListener("click", () => { player.pause(); player.currentTime = 0; document.getElementById("playerStatus").textContent = "Status: Stopped"; });
        document.getElementById("volUpBtn").addEventListener("click", () => { if (player.volume < 1) player.volume += 0.1; });
        document.getElementById("volDownBtn").addEventListener("click", () => { if (player.volume > 0) player.volume -= 0.1; });

        async function fetchNowPlaying() {
            try {
                const res = await fetch("https://albahrani.org/api/nowplaying");
                const data = await res.json();
                const station = data.find(s => s.station.shortcode === "shabakat_nur");
                if (station && station.now_playing.song.title) {
                    document.getElementById("trackTitle").textContent = station.now_playing.song.title;
                    document.getElementById("trackArtist").textContent = station.now_playing.song.artist || "";
                    document.getElementById("trackImage").src = station.now_playing.song.art || "https://albahrani.org/static/images/generic_album.jpg";
                }
            } catch (e) { }
        }

        async function loadSchedule() {
            const container = document.getElementById('schedule-list');
            container.innerHTML = 'Loading...';
            try {
                const res = await fetch('https://albahrani.org/api/station/shabakat_nur/schedule');
                const data = await res.json();
                container.innerHTML = '';
                if (!data.length) container.innerHTML = "No schedule available.";
                const lang = localStorage.getItem('language') || 'en';
                const now = new Date();
                data.forEach(show => {
                    const start = new Date(show.start);
                    const end = new Date(show.end);
                    const isNow = now >= start && now <= end;
                    const row = document.createElement('div');
                    row.style.borderBottom = "1px solid #444";
                    row.style.padding = "8px 0";
                    row.innerHTML = `
                        <div style="color: #ffcc00; font-weight:bold;">${show.name} ${isNow ? `<span style="background:red; color:white; font-size:10px; padding:2px;">${translations[lang].now_playing}</span>` : ''}</div>
                        <div style="font-size:12px; color:#ccc;">${start.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })} - ${end.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>
                    `;
                    container.appendChild(row);
                });
            } catch (e) { container.innerHTML = "Failed to load schedule."; }
        }

        function setLanguage(lang) {
            localStorage.setItem('language', lang);
            document.documentElement.lang = lang;
            document.documentElement.dir = (lang === 'ar' || lang === 'fa') ? 'rtl' : 'ltr';
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                if (translations[lang][key]) el.textContent = translations[lang][key];
            });
            const marq = document.getElementById('marquee-content');
            if (lang === 'ar' || lang === 'fa') marq.classList.add('rtl'); else marq.classList.remove('rtl');
            fetchPrayerInfo();
            if (getParameterByName('page') === 'schedule') loadSchedule();
            loadLibraries();
        }
        function searchLibraries(query) {
            const lang = localStorage.getItem("language") || "en";
            const results = [];

            Object.entries(libraries).forEach(([libKey, lib]) => {
                lib.items.forEach(item => {
                    let haystack = "";

                    // title
                    haystack += item.title?.[lang] || "";

                    // content
                    if (typeof item.content === "string") {
                        haystack += item.content;
                    } else if (item.content?.[lang]) {
                        haystack += item.content[lang];
                    }

                    if (haystack.toLowerCase().includes(query.toLowerCase())) {
                        results.push({ ...item, library: libKey });
                    }
                });
            });

            return results;
        }
        function renderSearchPage(query) {
            const container = document.getElementById("search-results");
            container.innerHTML = "";

            if (!query) {
                container.innerHTML = "<p>No search query.</p>";
                return;
            }

            const results = searchLibraries(query);

            if (!results.length) {
                container.innerHTML = `
        <p data-translate="no_results">
            ${translations[localStorage.getItem("language") || "en"].no_results}
        </p>
    `;
                return;
            }


            results.forEach(item => {
                const card = document.createElement("div");
                card.className = "retro-card";
                card.style.cursor = "pointer";
                card.textContent = item.title[localStorage.getItem("language") || "en"];

                card.onclick = () => {
                    dialogTitle.textContent = item.title[localStorage.getItem("language") || "en"];

                    if (item.type === "pdf") {
                        dialogBody.innerHTML = `
                    <iframe src="${item.file}" style="width:100%;height:70vh;border:none"></iframe>
                `;
                    } else {
                        const text = typeof item.content === "string"
                            ? item.content
                            : item.content?.[localStorage.getItem("language") || "en"] || "";

                        dialogBody.innerHTML = `
                    <div style="white-space:pre-wrap;line-height:1.9;font-size:1.05rem">
                        ${text}
                    </div>
                `;
                    }

                    dialog.showModal();
                };

                container.appendChild(card);
            });
        }

        document.getElementById('languageSelector').addEventListener('change', (e) => setLanguage(e.target.value));

        document.addEventListener('DOMContentLoaded', () => {
            const lang = localStorage.getItem('language') || 'en';
            document.getElementById('languageSelector').value = lang;
            setLanguage(lang);
            renderPage(getParameterByName('page'));
            fetchNowPlaying();
            setInterval(fetchNowPlaying, 30000);
        });

        document.getElementById('scrollTopBtn').addEventListener('click', (e) => {
            e.preventDefault();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    </script>

</body>

</html>